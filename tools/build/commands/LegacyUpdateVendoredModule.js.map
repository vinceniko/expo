{"version":3,"file":"LegacyUpdateVendoredModule.js","sourceRoot":"","sources":["../../src/commands/LegacyUpdateVendoredModule.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,4CAAoB;AACpB,gDAAwB;AACxB,kDAA0B;AAC1B,wDAA0B;AAC1B,kDAA0B;AAC1B,oDAA4B;AAC5B,wDAAgC;AAChC,gEAAgC;AAChC,gEAAuC;AACvC,oEAA2C;AAC3C,8CAAsB;AAGtB,4DAA8C;AAC9C,4CAA8B;AAC9B,4CAAwC;AACxC,wDAA0C;AAyC1C,MAAM,OAAO,GAAG,WAAW,CAAC,SAAS,EAAE,CAAC;AACxC,MAAM,WAAW,GAAG,WAAW,CAAC,aAAa,EAAE,CAAC;AAChD,MAAM,YAAY,GAAG,WAAW,CAAC,cAAc,EAAE,CAAC;AAClD,MAAM,2BAA2B,GAAG,cAAI,CAAC,IAAI,CAAC,YAAY,EAAE,MAAM,EAAE,2BAA2B,CAAC,CAAC;AAEjG,MAAM,kBAAkB,GAAmB,KAAK,WAC9C,YAAkC,EAClC,iBAAyB;IAEzB,MAAM,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IACxC,MAAM,yBAAyB,GAAG,cAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,SAAS,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;IACzF,MAAM,uBAAuB,GAAG,cAAI,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;IAClF,MAAM,mBAAmB,GAAG,SAAS,CAAC,oBAAqB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACjF,MAAM,mBAAmB,GAAG,SAAS,CAAC,oBAAqB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAEjF,MAAM,kBAAkB,GAAG,KAAK,IAAI,EAAE;QACpC,MAAM,eAAe,GAAG,cAAI,CAAC,IAAI,CAC/B,iBAAiB,EACjB,SAAS,EACT,KAAK,EACL,MAAM,EACN,KAAK,EACL,iBAAiB,CAClB,CAAC;QACF,MAAM,sBAAsB,GAAG,wBAAwB,CAAC;QACxD,MAAM,gBAAgB,GAAG,6BAA6B,CAAC;QACvD,MAAM,yBAAyB,GAAG,wCAAwC,CAAC;QAC3E,MAAM,mBAAmB,GAAG,4BAA4B,CAAC;QAEzD,MAAM,OAAO,GAAG,MAAM,kBAAE,CAAC,QAAQ,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;QAC3D,IAAI,kBAAkB,GAAG,OAAO,CAAC,OAAO,CAAC,yBAAyB,EAAE,sBAAsB,CAAC,CAAC;QAC5F,kBAAkB,GAAG,kBAAkB,CAAC,OAAO,CAC7C,IAAI,MAAM,CAAC,mBAAmB,EAAE,GAAG,CAAC,EACpC,gBAAgB,CACjB,CAAC;QAEF,MAAM,kBAAE,CAAC,SAAS,CAAC,eAAe,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;IAClE,CAAC,CAAC;IAEF,MAAM,kBAAkB,GAAG,KAAK,IAAI,EAAE;QACpC,MAAM,UAAU,GAAG,cAAI,CAAC,IAAI,CAAC,yBAAyB,EAAE,KAAK,EAAE,IAAI,EAAE,YAAY,CAAC,CAAC;QACnF,MAAM,UAAU,GAAG,MAAM,sBAAI,CAAC,UAAU,CAAC,CAAC;QAC1C,KAAK,MAAM,IAAI,IAAI,UAAU,EAAE;YAC7B,MAAM,OAAO,GAAG,MAAM,kBAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YAChD,MAAM,kBAAkB,GAAG,OAAO,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YACxF,MAAM,kBAAE,CAAC,SAAS,CAAC,IAAI,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;SACtD;IACH,CAAC,CAAC;IAEF,MAAM,OAAO,GAAG,KAAK,IAAI,EAAE;QACzB,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAC/B,KAAK,IAAI,GAAG,IAAI,IAAI,EAAE;YACpB,MAAM,kBAAE,CAAC,MAAM,CAAC,cAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ;YAClE,OAAO;YACP,MAAM,IAAI,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;gBAC7B,aAAG,CACD,cAAI,CAAC,IAAI,CAAC,yBAAyB,EAAE,GAAG,CAAC,EACzC,cAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,GAAG,CAAC,EACvC,EAAE,WAAW,EAAE,IAAI,EAAE,EACrB,GAAG,EAAE;oBACH,GAAG,EAAE,CAAC;gBACR,CAAC,CACF,CAAC;YACJ,CAAC,CAAC,CAAC;SACJ;IACH,CAAC,CAAC;IAEF,MAAM,qBAAqB,GAAG,KAAK,IAAI,EAAE;QACvC,MAAM,aAAa,GAAG,cAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,QAAQ,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;QACpF,MAAM,aAAa,GAAG,cAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,eAAe,CAAC,CAAC;QAC3F,MAAM,WAAW,GAAG,MAAM,sBAAI,CAAC,aAAa,CAAC,CAAC;QAC9C,MAAM,YAAY,GAAG,MAAM,sBAAI,CAAC,aAAa,CAAC,CAAC;QAC/C,MAAM,KAAK,GAAG,CAAC,GAAG,WAAW,EAAE,GAAG,YAAY,CAAC,CAAC;QAChD,KAAK,IAAI,IAAI,IAAI,KAAK,EAAE;YACtB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAClB,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,cAAI,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACnD,MAAM,kBAAE,CAAC,IAAI,CAAC,IAAI,EAAE,cAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC;SACpE;QAED,MAAM,kBAAE,CAAC,MAAM,CAAC,cAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC;IACjE,CAAC,CAAC;IAEF,MAAM,kBAAkB,EAAE,CAAC;IAC3B,MAAM,kBAAkB,EAAE,CAAC;IAC3B,MAAM,OAAO,EAAE,CAAC;IAChB,MAAM,qBAAqB,EAAE,CAAC;AAChC,CAAC,CAAC;AAEF,MAAM,qBAAqB,GAA4C;IACrE,8BAA8B,EAAE;QAC9B,OAAO,EAAE,sEAAsE;QAC/E,wBAAwB,EAAE,IAAI;QAC9B,YAAY,EAAE,GAAG;QACjB,KAAK,EAAE;YACL;gBACE,iBAAiB,EAAE,wDAAwD;gBAC3E,iBAAiB,EAAE,uCAAuC;gBAC1D,oBAAoB,EAAE,8BAA8B;gBACpD,oBAAoB,EAAE,mEAAmE;aAC1F;YACD;gBACE,SAAS,EAAE,IAAI;gBACf,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,+BAA+B;gBAC9C,iBAAiB,EAAE,0DAA0D;gBAC7E,iBAAiB,EAAE,6CAA6C;gBAChE,oBAAoB,EAAE,8BAA8B;gBACpD,oBAAoB,EAAE,mEAAmE;aAC1F;SACF;QACD,QAAQ,EAAE;YACR,sBAAsB,eAAK,CAAC,OAAO,CACjC,oBAAoB,CACrB,wEAAwE;SAC1E;KACF;IACD,yBAAyB,EAAE;QACzB,OAAO,EAAE,iEAAiE;QAC1E,wBAAwB,EAAE,IAAI;QAC9B,YAAY,EAAE,GAAG;QACjB,cAAc,EAAE,kBAAkB;QAClC,KAAK,EAAE;YACL;gBACE,SAAS,EAAE,IAAI;gBACf,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,gBAAgB;gBAC/B,iBAAiB,EAAE,gDAAgD;gBACnE,iBAAiB,EAAE,wBAAwB;gBAC3C,oBAAoB,EAAE,0BAA0B;gBAChD,oBAAoB,EAAE,oDAAoD;aAC3E;SACF;QACD,QAAQ,EAAE;YACR,sBAAsB,eAAK,CAAC,OAAO,CACjC,oBAAoB,CACrB,wEAAwE;YACzE,8CAA8C,eAAK,CAAC,OAAO,CAAC,IAAI,CAAC;QAC/D,eAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;SACxB;KACF;IACD,sBAAsB,EAAE;QACtB,OAAO,EAAE,8DAA8D;QACvE,wBAAwB,EAAE,IAAI;QAC9B,YAAY,EAAE,GAAG;QACjB,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,aAAa;gBAC5B,iBAAiB,EAAE,+CAA+C;gBAClE,iBAAiB,EAAE,qBAAqB;gBACxC,oBAAoB,EAAE,yBAAyB;gBAC/C,oBAAoB,EAAE,iDAAiD;aACxE;SACF;KACF;IACD,yBAAyB,EAAE;QACzB,OAAO,EAAE,qDAAqD;QAC9D,wBAAwB,EAAE,IAAI;QAC9B,YAAY,EAAE,GAAG;QACjB,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,gBAAgB;gBAC/B,aAAa,EAAE,gBAAgB;gBAC/B,iBAAiB,EAAE,0CAA0C;gBAC7D,iBAAiB,EAAE,sCAAsC;gBACzD,oBAAoB,EAAE,oBAAoB;gBAC1C,oBAAoB,EAAE,kEAAkE;aACzF;SACF;KACF;IACD,4BAA4B,EAAE;QAC5B,OAAO,EAAE,+CAA+C;QACxD,wBAAwB,EAAE,KAAK;QAC/B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,yCAAyC;gBACxD,aAAa,EAAE,aAAa;gBAC5B,iBAAiB,EACf,yEAAyE;gBAC3E,iBAAiB,EAAE,qBAAqB;gBACxC,oBAAoB,EAAE,eAAe;gBACrC,oBAAoB,EAAE,iDAAiD;aACxE;SACF;KACF;IACD,wBAAwB,EAAE;QACxB,OAAO,EAAE,mDAAmD;QAC5D,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,cAAc;gBAC7B,iBAAiB,EAAE,qDAAqD;gBACxE,iBAAiB,EAAE,sBAAsB;gBACzC,oBAAoB,EAAE,+BAA+B;gBACrD,oBAAoB,EAAE,kDAAkD;aACzE;SACF;KACF;IACD,qBAAqB,EAAE;QACrB,OAAO,EAAE,uEAAuE;QAChF,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,wDAAwD;gBACvE,iBAAiB,EAAE,0CAA0C;gBAC7D,iBAAiB,EACf,0FAA0F;gBAC5F,oBAAoB,EAAE,oBAAoB;gBAC1C,oBAAoB,EAAE,oBAAoB;gBAC1C,SAAS,EAAE,KAAK;gBAChB,aAAa,EAAE,KAAK;aACrB;SACF;KACF;IACD,qBAAqB,EAAE;QACrB,OAAO,EAAE,mEAAmE;QAC5E,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,SAAS,EAAE,KAAK;gBAChB,aAAa,EAAE,2BAA2B;gBAC1C,aAAa,EAAE,uBAAuB;gBACtC,iBAAiB,EAAE,2DAA2D;gBAC9E,iBAAiB,EAAE,+BAA+B;gBAClD,oBAAoB,EAAE,iCAAiC;gBACvD,oBAAoB,EAAE,2DAA2D;aAClF;SACF;KACF;IACD,kBAAkB,EAAE;QAClB,OAAO,EAAE,gEAAgE;QACzE,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,SAAS,EAAE,IAAI;gBACf,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,oBAAoB;gBACnC,iBAAiB,EAAE,uCAAuC;gBAC1D,iBAAiB,EAAE,4BAA4B;gBAC/C,oBAAoB,EAAE,iBAAiB;gBACvC,oBAAoB,EAAE,wDAAwD;aAC/E;SACF;KACF;IACD,mBAAmB,EAAE;QACnB,OAAO,EAAE,iEAAiE;QAC1E,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,uBAAuB;gBACtC,aAAa,EAAE,2BAA2B;aAC3C;YACD;gBACE,SAAS,EAAE,IAAI;gBACf,aAAa,EAAE,iBAAiB;gBAChC,aAAa,EAAE,qBAAqB;gBACpC,iBAAiB,EAAE,yDAAyD;gBAC5E,iBAAiB,EAAE,6BAA6B;gBAChD,oBAAoB,EAAE,+BAA+B;gBACrD,oBAAoB,EAAE,yDAAyD;aAChF;SACF;KACF;IACD,iCAAiC,EAAE;QACjC,OAAO,EAAE,oEAAoE;QAC7E,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,aAAa;gBAC5B,iBAAiB,EAAE,wDAAwD;gBAC3E,iBAAiB,EAAE,qBAAqB;gBACxC,oBAAoB,EAAE,kCAAkC;gBACxD,oBAAoB,EAAE,iDAAiD;aACxE;SACF;KACF;IACD,sBAAsB,EAAE;QACtB,OAAO,EAAE,oEAAoE;QAC7E,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,OAAO;gBACtB,aAAa,EAAE,wBAAwB;gBACvC,iBAAiB,EAAE,wDAAwD;gBAC3E,iBAAiB,EAAE,gCAAgC;gBACnD,oBAAoB,EAAE,kCAAkC;gBACxD,oBAAoB,EAAE,4DAA4D;aACnF;SACF;QACD,QAAQ,EAAE;YACR,eAAK,CAAC,IAAI,CAAC,MAAM,CACf,KAAK,eAAK,CAAC,KAAK,CAAC,sBAAsB,CAAC,YAAY,eAAK,CAAC,IAAI,CAC5D,eAAe,CAChB,0IAA0I,CAC5I;YACD,eAAK,CAAC,IAAI,CAAC,MAAM,CACf,cAAc,eAAK,CAAC,IAAI,CACtB,8EAA8E,CAC/E,KAAK,CACP;SACF;KACF;IACD,gCAAgC,EAAE;QAChC,OAAO,EAAE,6DAA6D;QACtE,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,kBAAkB;gBACjC,aAAa,EAAE,qBAAqB;gBACpC,iBAAiB,EAAE,qDAAqD;gBACxE,iBAAiB,EAAE,6BAA6B;gBAChD,oBAAoB,EAAE,+BAA+B;gBACrD,oBAAoB,EAAE,yDAAyD;aAChF;SACF;QACD,QAAQ,EAAE;YACR,eAAK,CAAC,IAAI,CAAC,MAAM,CACf,sBAAsB,eAAK,CAAC,KAAK,CAAC,gCAAgC,CAAC,SAAS,eAAK,CAAC,IAAI,CACpF,UAAU,CACX,wIAAwI,CAC1I;SACF;KACF;IACD,wCAAwC,EAAE;QACxC,OAAO,EAAE,2EAA2E;QACpF,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,+BAA+B;gBAC9C,iBAAiB,EAAE,2DAA2D;gBAC9E,iBAAiB,EAAE,uCAAuC;gBAC1D,oBAAoB,EAAE,qCAAqC;gBAC3D,oBAAoB,EAAE,mEAAmE;aAC1F;SACF;QACD,QAAQ,EAAE;YACR,0DAA0D,eAAK,CAAC,OAAO,CACrE,cAAc,CACf,wBAAwB,eAAK,CAAC,OAAO,CACpC,cAAc,CACf,mEAAmE;SACrE;KACF;IACD,qCAAqC,EAAE;QACrC,OAAO,EAAE,oEAAoE;QAC7E,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,2BAA2B;gBAC1C,iBAAiB,EAAE,kDAAkD;gBACrE,iBAAiB,EAAE,mCAAmC;gBACtD,oBAAoB,EAAE,4BAA4B;gBAClD,oBAAoB,EAAE,+DAA+D;aACtF;SACF;KACF;IACD,mCAAmC,EAAE;QACnC,OAAO,EAAE,kEAAkE;QAC3E,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,0BAA0B;gBACzC,iBAAiB,EAAE,0DAA0D;gBAC7E,iBAAiB,EAAE,kCAAkC;gBACrD,oBAAoB,EAAE,oCAAoC;gBAC1D,oBAAoB,EAAE,8DAA8D;aACrF;SACF;KACF;IACD,6BAA6B,EAAE;QAC7B,OAAO,EAAE,4DAA4D;QACrE,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,8BAA8B;gBAC7C,iBAAiB,EAAE,qDAAqD;gBACxE,iBAAiB,EAAE,sCAAsC;gBACzD,oBAAoB,EAAE,+BAA+B;gBACrD,oBAAoB,EAAE,kEAAkE;aACzF;SACF;KACF;IACD,2CAA2C,EAAE;QAC3C,OAAO,EAAE,6DAA6D;QACtE,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,iCAAiC;aACjD;SACF;KACF;IACD,6BAA6B,EAAE;QAC7B,OAAO,EAAE,+CAA+C;QACxD,wBAAwB,EAAE,IAAI;QAC9B,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,uBAAuB;gBACtC,iBAAiB,EAAE,uDAAuD;gBAC1E,iBAAiB,EAAE,+BAA+B;gBAClD,oBAAoB,EAAE,iCAAiC;gBACvD,oBAAoB,EAAE,2DAA2D;aAClF;SACF;KACF;IACD,gCAAgC,EAAE;QAChC,OAAO,EAAE,+DAA+D;QACxE,wBAAwB,EAAE,IAAI;QAC9B,eAAe,EAAE,KAAK;QACtB,KAAK,EAAE;YACL;gBACE,aAAa,EAAE,SAAS;gBACxB,aAAa,EAAE,uBAAuB;gBACtC,iBAAiB,EAAE,2DAA2D;gBAC9E,iBAAiB,EAAE,+BAA+B;gBAClD,oBAAoB,EAAE,iCAAiC;gBACvD,oBAAoB,EAAE,2DAA2D;aAClF;SACF;KACF;CACF,CAAC;AAEF,KAAK,UAAU,4BAA4B;IACzC,OAAO,CAAC,MAAM,mBAAQ,CAAC,SAAS,CAAC,2BAA2B,CAAC,CAA8B,CAAC;AAC9F,CAAC;AAED,KAAK,UAAU,+BAA+B,CAAC,OAAO;IACpD,OAAO,CAAC,GAAG,CAAC,cAAc,eAAK,CAAC,OAAO,CAAC,2BAA2B,CAAC,MAAM,CAAC,CAAC;IAE5E,MAAM,QAAQ,GAAG,IAAI,mBAAQ,CAAC,2BAA2B,CAAC,CAAC;IAC3D,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,SAAS,EAAE,CAAC;IACxC,MAAM,QAAQ,CAAC,UAAU,CAAC,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjD,CAAC;AAED,KAAK,UAAU,qBAAqB,CAAC,IAAY,EAAE,SAAiB;IAClE,MAAM,OAAO,GAAG,MAAM,kBAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAEhD,mFAAmF;IACnF,MAAM,kBAAkB,GAAG,OAAO,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;IAC7E,MAAM,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAElD,MAAM,kBAAE,CAAC,SAAS,CAAC,WAAW,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;IAC5D,MAAM,kBAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACxB,CAAC;AAED,KAAK,UAAU,kBAAkB,CAAC,GAAW,EAAE,SAAkB;IAC/D,MAAM,OAAO,GAAG,cAAI,CAAC,IAAI,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,yBAAyB,CAAC,CAAC;IACjF,OAAO,MAAM,sBAAI,CAAC,OAAO,CAAC,CAAC;AAC7B,CAAC;AAED,KAAK,UAAU,yBAAyB,CACtC,IAAY,EACZ,oBAA4B,EAC5B,oBAA4B;IAE5B,MAAM,OAAO,GAAG,MAAM,kBAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAEhD,4EAA4E;IAC5E,oEAAoE;IACpE,sBAAsB;IACtB,MAAM,kBAAkB,GAAG,OAAO,CAAC,OAAO,CACxC,IAAI,MAAM,CAAC,oBAAoB,EAAE,GAAG,CAAC,EACrC,oBAAoB,CACrB,CAAC;IAEF,MAAM,kBAAE,CAAC,SAAS,CAAC,IAAI,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;AACvD,CAAC;AAED,KAAK,UAAU,qBAAqB,CAAC,GAAW;IAC9C,MAAM,OAAO,GAAG,cAAI,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,cAAc,CAAC,CAAC;IACrD,OAAO,MAAM,sBAAI,CAAC,OAAO,CAAC,CAAC;AAC7B,CAAC;AAED,KAAK,UAAU,sBAAsB,CAAC,IAAY;IAChD,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QACrC,MAAM,OAAO,GAAG,eAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACpC,OAAO,CAAC,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IACjE,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,aAAa,CAAC,IAAI;IACzB,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IAChC,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC;IACzB,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC5B,OAAO,GAAG,CAAC;AACb,CAAC;AAED,SAAS,uBAAuB,CAAC,KAAU,EAAE,GAAW;IACtD,OAAO,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,KAAK,GAAG,CAAC,CAAC;AAC7D,CAAC;AAED,KAAK,UAAU,qBAAqB,CAClC,QAAgB,EAChB,SAAiB,EACjB,OAAY;IAEZ,MAAM,QAAQ,GAAG,cAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAEzC,sHAAsH;IACtH,MAAM,WAAW,GAAG,OAAO,CAAC,cAAc,CAAC,cAAI,CAAC,QAAQ,CAAC,cAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;IAEnF,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;QAC9B,OAAO,CAAC,GAAG,CAAC,UAAU,eAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,+BAA+B,CAAC,CAAC;QAE9E,MAAM,WAAW,GAAG;YAClB,wCAAwC;YACxC,aAAa,EAAE,IAAI;SACpB,CAAC;QAEF,wDAAwD;QACxD,MAAM,SAAS,GAAG,cAAI,CAAC,QAAQ,CAAC,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;QAExD,8BAA8B;QAC9B,MAAM,IAAI,GACR,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,IAAI;YAC7B,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,QAAQ,EAAE,WAAW,EAAE,SAAS,CAAC;YACzD,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,QAAQ,EAAE,WAAW,EAAE,SAAS,CAAC,CAAC;QAE9D,wDAAwD;QACxD,MAAM,KAAK,GAAG,OAAO,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;QAEhD,yEAAyE;QACzE,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC;QAExB,IAAI,KAAK,EAAE;YACT,yCAAyC;YACzC,IAAI,CAAC,uBAAuB,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE;gBACjD,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;aAC1C;SACF;aAAM;YACL,qCAAqC;YACrC,MAAM,EAAE,IAAI,EAAE,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;YAExE,+CAA+C;YAC/C,IAAI,CAAC,uBAAuB,CAAC,WAAW,EAAE,IAAI,CAAC,EAAE;gBAC/C,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;aAClF;SACF;KACF;AACH,CAAC;AAED,KAAK,UAAU,cAAc,CAC3B,KAAe,EACf,SAAiB,EACjB,SAAiB;IAEjB,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;QACxB,MAAM,gBAAgB,GAAG,cAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACxD,MAAM,cAAc,GAAG,cAAI,CAAC,IAAI,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;QAE9D,MAAM,kBAAE,CAAC,MAAM,CAAC,cAAI,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC;QAC9C,MAAM,kBAAE,CAAC,IAAI,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;QAEpC,OAAO,CAAC,GAAG,CAAC,eAAK,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,eAAK,CAAC,OAAO,CAAC,cAAI,CAAC,QAAQ,CAAC,oBAAQ,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC;KACxF;AACH,CAAC;AAED,KAAK,UAAU,iCAAiC,CAAC,eAAwB,KAAK;IAC5E,MAAM,oBAAoB,GAAG,MAAM,4BAA4B,EAAE,CAAC;IAClE,MAAM,oBAAoB,GAAG,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;IAChE,MAAM,YAAY,GAA0B,MAAM,OAAO,CAAC,GAAG,CAC3D,oBAAoB,CAAC,GAAG,CAAC,CAAC,WAAmB,EAAE,EAAE,CAAC,GAAG,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC,CACxF,CAAC;IAEF,KAAK,MAAM,WAAW,IAAI,oBAAoB,EAAE;QAC9C,MAAM,WAAW,GAAG,YAAY,CAAC,KAAK,EAAE,CAAC;QAEzC,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,CAAC,KAAK,CACX,eAAK,CAAC,GAAG,CAAC,IAAI,CAAC,iCAAiC,eAAK,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CACpF,CAAC;YACF,SAAS;SACV;QAED,MAAM,YAAY,GAAG,qBAAqB,CAAC,WAAW,CAAC,CAAC;QACxD,MAAM,cAAc,GAAG,oBAAoB,CAAC,WAAW,CAAC,CAAC;QACzD,MAAM,aAAa,GAAG,WAAW,CAAC,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE5E,IAAI,CAAC,YAAY,IAAI,CAAC,cAAc,IAAI,gBAAM,CAAC,GAAG,CAAC,aAAa,EAAE,cAAc,CAAC,EAAE;YACjF,OAAO,CAAC,GAAG,CAAC,eAAK,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC;YAC3C,OAAO,CAAC,GAAG,CAAC,GAAG,eAAK,CAAC,MAAM,CAAC,GAAG,CAAC,qBAAqB,eAAK,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAC5F,OAAO,CAAC,GAAG,CACT,GAAG,eAAK,CAAC,MAAM,CAAC,GAAG,CAAC,qBAAqB,CAAC,cAAc,CAAC,CAAC,CAAC,eAAK,CAAC,IAAI,CAAC,CAAC,CAAC,eAAK,CAAC,IAAI,CAAC,CACjF,cAAc,CACf,EAAE,CACJ,CAAC;YACF,OAAO,CAAC,GAAG,CAAC,GAAG,eAAK,CAAC,MAAM,CAAC,GAAG,CAAC,qBAAqB,eAAK,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;YAClF,OAAO,CAAC,GAAG,EAAE,CAAC;SACf;KACF;AACH,CAAC;AAED,KAAK,UAAU,iBAAiB;IAC9B,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,kBAAQ,CAAC,MAAM,CAAyB;QACnE;YACE,IAAI,EAAE,MAAM;YACZ,IAAI,EAAE,YAAY;YAClB,OAAO,EAAE,kDAAkD;YAC3D,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC;SAC5C;KACF,CAAC,CAAC;IACH,OAAO,UAAU,CAAC;AACpB,CAAC;AAED,KAAK,UAAU,MAAM,CAAC,OAAsB;;IAC1C,IAAI,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,YAAY,EAAE;QACxC,MAAM,iCAAiC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;QAC9D,OAAO;KACR;IAED,MAAM,UAAU,GAAG,OAAO,CAAC,MAAM,IAAI,CAAC,MAAM,iBAAiB,EAAE,CAAC,CAAC;IACjE,MAAM,YAAY,GAAG,qBAAqB,CAAC,UAAU,CAAC,CAAC;IAEvD,IAAI,CAAC,YAAY,EAAE;QACjB,MAAM,IAAI,KAAK,CACb,YAAY,eAAK,CAAC,KAAK,CACrB,UAAU,CACX,+GAA+G,CACjH,CAAC;KACH;IAED,YAAY,CAAC,wBAAwB;QACnC,YAAY,CAAC,wBAAwB,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,YAAY,CAAC,wBAAwB,CAAC;IAE/F,MAAM,MAAM,GAAG,cAAI,CAAC,IAAI,CAAC,YAAE,CAAC,MAAM,EAAE,EAAE,UAAU,CAAC,CAAC;IAElD,mBAAmB;IACnB,MAAM,kBAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;IAExB,OAAO,CAAC,GAAG,CACT,WAAW,eAAK,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,eAAK,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,eAAK,CAAC,IAAI,CAC9D,OAAO,CAAC,MAAM,CACf,kBAAkB,CACpB,CAAC;IAEF,wBAAwB;IACxB,MAAM,qBAAU,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;IAEjE,iDAAiD;IACjD,MAAM,qBAAU,CAAC,KAAK,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC,CAAC;IAEvE,IAAI,YAAY,CAAC,QAAQ,EAAE;QACzB,YAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;KACnE;IAED,IAAI,YAAY,CAAC,cAAc,EAAE;QAC/B,MAAM,YAAY,CAAC,cAAc,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;KACzD;IAED,KAAK,MAAM,IAAI,IAAI,YAAY,CAAC,KAAK,EAAE;QACrC,MAAM,cAAc,GAAG,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACrE,MAAM,UAAU,GAAG,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAE7D,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC;QACzC,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,IAAI,CAAC,aAAa,KAAK,KAAK,CAAC,CAAC;QAErD,MAAM;QACN,IAAI,UAAU,IAAI,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,EAAE;YAC1D,MAAM,SAAS,GAAG,cAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;YACxD,MAAM,SAAS,GAAG,cAAI,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,EAAE,WAAW,EAAE,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;YAE1F,OAAO,CAAC,GAAG,CACT,8BAA8B,eAAK,CAAC,OAAO,CAAC,cAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,MAAM,CACrF,CAAC;YAEF,MAAM,kBAAE,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YAC3B,MAAM,kBAAE,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YAE3B,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;YAEvC,MAAM,SAAS,GAAG,MAAM,kBAAkB,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YACtE,MAAM,WAAW,GAAG,cAAI,CAAC,IAAI,CAAC,OAAO,EAAE,oBAAoB,EAAE,iBAAiB,CAAC,CAAC;YAChF,MAAM,OAAO,GAAG,MAAM,sBAAsB,CAAC,WAAW,CAAC,CAAC;YAE1D,MAAM,cAAc,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;YAEtD,IAAI,OAAO,CAAC,OAAO,IAAI,IAAI,CAAC,aAAa,EAAE;gBACzC,OAAO,CAAC,GAAG,CAAC,sCAAsC,CAAC,CAAC;gBAEpD,KAAK,MAAM,IAAI,IAAI,SAAS,EAAE;oBAC5B,MAAM,gBAAgB,GAAG,cAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;oBACxD,MAAM,cAAc,GAAG,cAAI,CAAC,IAAI,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;oBAE9D,MAAM,qBAAqB,CAAC,cAAc,EAAE,SAAS,EAAE,OAAO,CAAC,CAAC;iBACjE;gBAED,OAAO,CAAC,GAAG,CACT,gDAAgD,eAAK,CAAC,OAAO,CAC3D,cAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,WAAW,CAAC,CACpC,MAAM,CACR,CAAC;gBACF,MAAM,kBAAE,CAAC,SAAS,CAAC,WAAW,EAAE,OAAO,CAAC,SAAS,EAAE,CAAC,CAAC;aACtD;YAED,IAAI,IAAI,CAAC,SAAS,EAAE;gBAClB,OAAO,CAAC,GAAG,CAAC,gCAAgC,eAAK,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBAEhF,MAAM,KAAK,GAAG,MAAM,kBAAkB,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;gBAElE,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;oBACxB,MAAM,qBAAqB,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;iBACnD;aACF;YAED,OAAO,CAAC,GAAG,CACT,eAAK,CAAC,MAAM,CACV,qGAAqG,eAAK,CAAC,OAAO,CAChH,2BAA2B,IAAI,CAAC,aAAa,EAAE,CAChD,EAAE,CACJ,CACF,CAAC;SACH;QAED,UAAU;QACV,IACE,cAAc;YACd,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,oBAAoB;YACzB,IAAI,CAAC,oBAAoB,EACzB;YACA,MAAM,SAAS,GAAG,cAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAC5D,MAAM,SAAS,GAAG,cAAI,CAAC,IAAI,CACzB,WAAW,EACX,UAAU,EACV,KAAK,EACL,MAAM,EACN,MAAM,EACN,WAAW,EACX,MAAM,EACN,KAAK,EACL,UAAU,EACV,IAAI,CAAC,iBAAiB,CACvB,CAAC;YAEF,OAAO,CAAC,GAAG,CACT,kCAAkC,eAAK,CAAC,OAAO,CAAC,cAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC,MAAM,CAC7F,CAAC;YAEF,MAAM,kBAAE,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YAC3B,MAAM,kBAAE,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YAE3B,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;YAE3C,MAAM,SAAS,GAAG,MAAM,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEzD,MAAM,cAAc,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC;YAEtD,MAAM,KAAK,GAAG,MAAM,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAErD,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;gBACxB,MAAM,yBAAyB,CAAC,IAAI,EAAE,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;aAC7F;SACF;KACF;IACD,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,MAAM,mBAAQ,CAAC,SAAS,CAG/C,cAAI,CAAC,IAAI,CAAC,MAAM,QAAE,YAAY,CAAC,eAAe,mCAAI,EAAE,EAAE,cAAc,CAAC,CAAC,CAAC;IAC1E,MAAM,YAAY,GAChB,CAAC,OAAO,CAAC,YAAY,IAAI,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;IAC1F,MAAM,YAAY,GAAG,GAAG,YAAY,GAAG,OAAO,EAAE,CAAC;IAEjD,MAAM,+BAA+B,CAAC,KAAK,EAAE,oBAAoB,EAAE,EAAE;QACnE,IAAI,YAAY,CAAC,wBAAwB,EAAE;YACzC,oBAAoB,CAAC,IAAI,CAAC,GAAG,YAAY,CAAC;YAC1C,OAAO,CAAC,GAAG,CACT,WAAW,eAAK,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,eAAK,CAAC,OAAO,CAC9C,2BAA2B,CAC5B,qBAAqB,eAAK,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CACjD,CAAC;SACH;aAAM,IAAI,oBAAoB,CAAC,IAAI,CAAC,EAAE;YACrC,OAAO,oBAAoB,CAAC,IAAI,CAAC,CAAC;YAClC,OAAO,CAAC,GAAG,CACT,mCAAmC,eAAK,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,eAAK,CAAC,OAAO,CACxE,2BAA2B,CAC5B,EAAE,CACJ,CAAC;SACH;QACD,OAAO,oBAAoB,CAAC;IAC9B,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,GAAG,CAAC,cAAc,eAAK,CAAC,KAAK,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;IAExE,MAAM,SAAS,CAAC,qBAAqB,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC;IAE1D,OAAO,CAAC,GAAG,CAAC,eAAe,eAAK,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAEtD,kDAAkD;IAClD,MAAM,SAAS,CAAC,YAAY,EAAE,CAAC;IAE/B,OAAO,CAAC,GAAG,CACT,uBAAuB,eAAK,CAAC,KAAK,CAChC,UAAU,CACX,wHAAwH,CAC1H,CAAC;AACJ,CAAC;AAED,kBAAe,CAAC,OAAgB,EAAE,EAAE;IAClC,OAAO;SACJ,OAAO,CAAC,wBAAwB,CAAC;SACjC,KAAK,CAAC,eAAe,EAAE,KAAK,CAAC;SAC7B,WAAW,CAAC,4BAA4B,CAAC;SACzC,MAAM,CAAC,YAAY,EAAE,8CAA8C,EAAE,KAAK,CAAC;SAC3E,MAAM,CAAC,qBAAqB,EAAE,6CAA6C,EAAE,KAAK,CAAC;SACnF,MAAM,CAAC,uBAAuB,EAAE,+BAA+B,CAAC;SAChE,MAAM,CACL,yBAAyB,EACzB,0DAA0D,EAC1D,KAAK,CACN;SACA,MAAM,CACL,uBAAuB,EACvB,mEAAmE,EACnE,QAAQ,CACT;SACA,MAAM,CACL,8BAA8B,EAC9B,yMAAyM,EACzM,IAAI,CACL;SACA,MAAM,CAAC,cAAc,EAAE,gDAAgD,EAAE,KAAK,CAAC;SAC/E,WAAW,CAAC,MAAM,CAAC,CAAC;AACzB,CAAC,CAAC","sourcesContent":["import os from 'os';\nimport path from 'path';\nimport chalk from 'chalk';\nimport fs from 'fs-extra';\nimport xcode from 'xcode';\nimport semver from 'semver';\nimport inquirer from 'inquirer';\nimport glob from 'glob-promise';\nimport JsonFile from '@expo/json-file';\nimport spawnAsync from '@expo/spawn-async';\nimport ncp from 'ncp';\nimport { Command } from '@expo/commander';\n\nimport * as Directories from '../Directories';\nimport * as Npm from '../Npm';\nimport { EXPO_DIR } from '../Constants';\nimport * as Workspace from '../Workspace';\n\ninterface ActionOptions {\n  list: boolean;\n  listOutdated: boolean;\n  module: string;\n  platform: 'ios' | 'android' | 'all';\n  commit: string;\n  pbxproj: boolean;\n  semverPrefix: string;\n}\n\ninterface VendoredModuleUpdateStep {\n  iosPrefix?: string;\n  sourceIosPath?: string;\n  targetIosPath?: string;\n  sourceAndroidPath?: string;\n  targetAndroidPath?: string;\n  sourceAndroidPackage?: string;\n  targetAndroidPackage?: string;\n  recursive?: boolean;\n  updatePbxproj?: boolean;\n}\n\ntype ModuleModifier = (\n  moduleConfig: VendoredModuleConfig,\n  clonedProjectPath: string\n) => Promise<void>;\n\ninterface VendoredModuleConfig {\n  repoUrl: string;\n  packageName?: string;\n  packageJsonPath?: string;\n  installableInManagedApps?: boolean;\n  semverPrefix?: '~' | '^';\n  skipCleanup?: boolean;\n  steps: VendoredModuleUpdateStep[];\n  moduleModifier?: ModuleModifier;\n  warnings?: string[];\n}\n\nconst IOS_DIR = Directories.getIosDir();\nconst ANDROID_DIR = Directories.getAndroidDir();\nconst PACKAGES_DIR = Directories.getPackagesDir();\nconst BUNDLED_NATIVE_MODULES_PATH = path.join(PACKAGES_DIR, 'expo', 'bundledNativeModules.json');\n\nconst ReanimatedModifier: ModuleModifier = async function (\n  moduleConfig: VendoredModuleConfig,\n  clonedProjectPath: string\n): Promise<void> {\n  const firstStep = moduleConfig.steps[0];\n  const androidMainPathReanimated = path.join(clonedProjectPath, 'android', 'src', 'main');\n  const androidMainPathExpoview = path.join(ANDROID_DIR, 'expoview', 'src', 'main');\n  const JNIOldPackagePrefix = firstStep.sourceAndroidPackage!.split('.').join('/');\n  const JNINewPackagePrefix = firstStep.targetAndroidPackage!.split('.').join('/');\n\n  const replaceHermesByJSC = async () => {\n    const nativeProxyPath = path.join(\n      clonedProjectPath,\n      'android',\n      'src',\n      'main',\n      'cpp',\n      'NativeProxy.cpp'\n    );\n    const runtimeCreatingLineJSC = 'jsc::makeJSCRuntime();';\n    const jscImportingLine = '#include <jsi/JSCRuntime.h>';\n    const runtimeCreatingLineHermes = 'facebook::hermes::makeHermesRuntime();';\n    const hermesImportingLine = '#include <hermes/hermes.h>';\n\n    const content = await fs.readFile(nativeProxyPath, 'utf8');\n    let transformedContent = content.replace(runtimeCreatingLineHermes, runtimeCreatingLineJSC);\n    transformedContent = transformedContent.replace(\n      new RegExp(hermesImportingLine, 'g'),\n      jscImportingLine\n    );\n\n    await fs.writeFile(nativeProxyPath, transformedContent, 'utf8');\n  };\n\n  const replaceJNIPackages = async () => {\n    const cppPattern = path.join(androidMainPathReanimated, 'cpp', '**', '*.@(h|cpp)');\n    const androidCpp = await glob(cppPattern);\n    for (const file of androidCpp) {\n      const content = await fs.readFile(file, 'utf8');\n      const transformedContent = content.split(JNIOldPackagePrefix).join(JNINewPackagePrefix);\n      await fs.writeFile(file, transformedContent, 'utf8');\n    }\n  };\n\n  const copyCPP = async () => {\n    const dirs = ['Common', 'cpp'];\n    for (let dir of dirs) {\n      await fs.remove(path.join(androidMainPathExpoview, dir)); // clean\n      // copy\n      await new Promise((res, rej) => {\n        ncp(\n          path.join(androidMainPathReanimated, dir),\n          path.join(androidMainPathExpoview, dir),\n          { dereference: true },\n          () => {\n            res();\n          }\n        );\n      });\n    }\n  };\n\n  const prepareIOSNativeFiles = async () => {\n    const patternCommon = path.join(clonedProjectPath, 'Common', '**', '*.@(h|mm|cpp)');\n    const patternNative = path.join(clonedProjectPath, 'ios', 'native', '**', '*.@(h|mm|cpp)');\n    const commonFiles = await glob(patternCommon);\n    const iosOnlyFiles = await glob(patternNative);\n    const files = [...commonFiles, ...iosOnlyFiles];\n    for (let file of files) {\n      console.log(file);\n      const fileName = file.split(path.sep).slice(-1)[0];\n      await fs.copy(file, path.join(clonedProjectPath, 'ios', fileName));\n    }\n\n    await fs.remove(path.join(clonedProjectPath, 'ios', 'native'));\n  };\n\n  await replaceHermesByJSC();\n  await replaceJNIPackages();\n  await copyCPP();\n  await prepareIOSNativeFiles();\n};\n\nconst vendoredModulesConfig: { [key: string]: VendoredModuleConfig } = {\n  'react-native-gesture-handler': {\n    repoUrl: 'https://github.com/software-mansion/react-native-gesture-handler.git',\n    installableInManagedApps: true,\n    semverPrefix: '~',\n    steps: [\n      {\n        sourceAndroidPath: 'android/lib/src/main/java/com/swmansion/gesturehandler',\n        targetAndroidPath: 'modules/api/components/gesturehandler',\n        sourceAndroidPackage: 'com.swmansion.gesturehandler',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.gesturehandler',\n      },\n      {\n        recursive: true,\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/GestureHandler',\n        sourceAndroidPath: 'android/src/main/java/com/swmansion/gesturehandler/react',\n        targetAndroidPath: 'modules/api/components/gesturehandler/react',\n        sourceAndroidPackage: 'com.swmansion.gesturehandler',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.gesturehandler',\n      },\n    ],\n    warnings: [\n      `NOTE: Any files in ${chalk.magenta(\n        'com.facebook.react'\n      )} will not be updated -- you'll need to add these to expoview manually!`,\n    ],\n  },\n  'react-native-reanimated': {\n    repoUrl: 'https://github.com/software-mansion/react-native-reanimated.git',\n    installableInManagedApps: true,\n    semverPrefix: '~',\n    moduleModifier: ReanimatedModifier,\n    steps: [\n      {\n        recursive: true,\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Reanimated',\n        sourceAndroidPath: 'android/src/main/java/com/swmansion/reanimated',\n        targetAndroidPath: 'modules/api/reanimated',\n        sourceAndroidPackage: 'com.swmansion.reanimated',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.reanimated',\n      },\n    ],\n    warnings: [\n      `NOTE: Any files in ${chalk.magenta(\n        'com.facebook.react'\n      )} will not be updated -- you'll need to add these to expoview manually!`,\n      `NOTE: Some imports have to be changed from ${chalk.magenta('<>')} form to \n      ${chalk.magenta('\"\"')}`,\n    ],\n  },\n  'react-native-screens': {\n    repoUrl: 'https://github.com/software-mansion/react-native-screens.git',\n    installableInManagedApps: true,\n    semverPrefix: '~',\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Screens',\n        sourceAndroidPath: 'android/src/main/java/com/swmansion/rnscreens',\n        targetAndroidPath: 'modules/api/screens',\n        sourceAndroidPackage: 'com.swmansion.rnscreens',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.screens',\n      },\n    ],\n  },\n  'react-native-appearance': {\n    repoUrl: 'https://github.com/expo/react-native-appearance.git',\n    installableInManagedApps: true,\n    semverPrefix: '~',\n    steps: [\n      {\n        sourceIosPath: 'ios/Appearance',\n        targetIosPath: 'Api/Appearance',\n        sourceAndroidPath: 'android/src/main/java/io/expo/appearance',\n        targetAndroidPath: 'modules/api/appearance/rncappearance',\n        sourceAndroidPackage: 'io.expo.appearance',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.appearance.rncappearance',\n      },\n    ],\n  },\n  'amazon-cognito-identity-js': {\n    repoUrl: 'https://github.com/aws-amplify/amplify-js.git',\n    installableInManagedApps: false,\n    steps: [\n      {\n        sourceIosPath: 'packages/amazon-cognito-identity-js/ios',\n        targetIosPath: 'Api/Cognito',\n        sourceAndroidPath:\n          'packages/amazon-cognito-identity-js/android/src/main/java/com/amazonaws',\n        targetAndroidPath: 'modules/api/cognito',\n        sourceAndroidPackage: 'com.amazonaws',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.cognito',\n      },\n    ],\n  },\n  'react-native-view-shot': {\n    repoUrl: 'https://github.com/gre/react-native-view-shot.git',\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/ViewShot',\n        sourceAndroidPath: 'android/src/main/java/fr/greweb/reactnativeviewshot',\n        targetAndroidPath: 'modules/api/viewshot',\n        sourceAndroidPackage: 'fr.greweb.reactnativeviewshot',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.viewshot',\n      },\n    ],\n  },\n  'react-native-branch': {\n    repoUrl: 'https://github.com/BranchMetrics/react-native-branch-deep-linking.git',\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: '../../../../packages/expo-branch/ios/EXBranch/RNBranch',\n        sourceAndroidPath: 'android/src/main/java/io/branch/rnbranch',\n        targetAndroidPath:\n          '../../../../../../../../../packages/expo-branch/android/src/main/java/io/branch/rnbranch',\n        sourceAndroidPackage: 'io.branch.rnbranch',\n        targetAndroidPackage: 'io.branch.rnbranch',\n        recursive: false,\n        updatePbxproj: false,\n      },\n    ],\n  },\n  'lottie-react-native': {\n    repoUrl: 'https://github.com/react-native-community/lottie-react-native.git',\n    installableInManagedApps: true,\n    steps: [\n      {\n        iosPrefix: 'LRN',\n        sourceIosPath: 'src/ios/LottieReactNative',\n        targetIosPath: 'Api/Components/Lottie',\n        sourceAndroidPath: 'src/android/src/main/java/com/airbnb/android/react/lottie',\n        targetAndroidPath: 'modules/api/components/lottie',\n        sourceAndroidPackage: 'com.airbnb.android.react.lottie',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.lottie',\n      },\n    ],\n  },\n  'react-native-svg': {\n    repoUrl: 'https://github.com/react-native-community/react-native-svg.git',\n    installableInManagedApps: true,\n    steps: [\n      {\n        recursive: true,\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/Svg',\n        sourceAndroidPath: 'android/src/main/java/com/horcrux/svg',\n        targetAndroidPath: 'modules/api/components/svg',\n        sourceAndroidPackage: 'com.horcrux.svg',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.svg',\n      },\n    ],\n  },\n  'react-native-maps': {\n    repoUrl: 'https://github.com/react-native-community/react-native-maps.git',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'lib/ios/AirGoogleMaps',\n        targetIosPath: 'Api/Components/GoogleMaps',\n      },\n      {\n        recursive: true,\n        sourceIosPath: 'lib/ios/AirMaps',\n        targetIosPath: 'Api/Components/Maps',\n        sourceAndroidPath: 'lib/android/src/main/java/com/airbnb/android/react/maps',\n        targetAndroidPath: 'modules/api/components/maps',\n        sourceAndroidPackage: 'com.airbnb.android.react.maps',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.maps',\n      },\n    ],\n  },\n  '@react-native-community/netinfo': {\n    repoUrl: 'https://github.com/react-native-community/react-native-netinfo.git',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/NetInfo',\n        sourceAndroidPath: 'android/src/main/java/com/reactnativecommunity/netinfo',\n        targetAndroidPath: 'modules/api/netinfo',\n        sourceAndroidPackage: 'com.reactnativecommunity.netinfo',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.netinfo',\n      },\n    ],\n  },\n  'react-native-webview': {\n    repoUrl: 'https://github.com/react-native-community/react-native-webview.git',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'apple',\n        targetIosPath: 'Api/Components/WebView',\n        sourceAndroidPath: 'android/src/main/java/com/reactnativecommunity/webview',\n        targetAndroidPath: 'modules/api/components/webview',\n        sourceAndroidPackage: 'com.reactnativecommunity.webview',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.webview',\n      },\n    ],\n    warnings: [\n      chalk.bold.yellow(\n        `\\n${chalk.green('react-native-webview')} exposes ${chalk.blue(\n          'useSharedPool'\n        )} property which has to be handled differently in Expo Client. After upgrading this library, please ensure that proper patch is in place.`\n      ),\n      chalk.bold.yellow(\n        `See commit ${chalk.cyan(\n          'https://github.com/expo/expo/commit/3aeb66e33dc391399ea1c90fd166425130d17a12'\n        )}.\\n`\n      ),\n    ],\n  },\n  'react-native-safe-area-context': {\n    repoUrl: 'https://github.com/th3rdwave/react-native-safe-area-context',\n    steps: [\n      {\n        sourceIosPath: 'ios/SafeAreaView',\n        targetIosPath: 'Api/SafeAreaContext',\n        sourceAndroidPath: 'android/src/main/java/com/th3rdwave/safeareacontext',\n        targetAndroidPath: 'modules/api/safeareacontext',\n        sourceAndroidPackage: 'com.th3rdwave.safeareacontext',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.safeareacontext',\n      },\n    ],\n    warnings: [\n      chalk.bold.yellow(\n        `Last time checked, ${chalk.green('react-native-safe-area-context')} used ${chalk.blue(\n          'androidx'\n        )} which wasn't at that time supported by Expo. Please ensure that the project builds on Android after upgrading or remove this warning.`\n      ),\n    ],\n  },\n  '@react-native-community/datetimepicker': {\n    repoUrl: 'https://github.com/react-native-community/react-native-datetimepicker.git',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/DateTimePicker',\n        sourceAndroidPath: 'android/src/main/java/com/reactcommunity/rndatetimepicker',\n        targetAndroidPath: 'modules/api/components/datetimepicker',\n        sourceAndroidPackage: 'com.reactcommunity.rndatetimepicker',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.datetimepicker',\n      },\n    ],\n    warnings: [\n      `NOTE: In Expo, native Android styles are prefixed with ${chalk.magenta(\n        'ReactAndroid'\n      )}. Please ensure that ${chalk.magenta(\n        'resourceName'\n      )}s used for grabbing style of dialogs are being resolved properly.`,\n    ],\n  },\n  '@react-native-community/masked-view': {\n    repoUrl: 'https://github.com/react-native-community/react-native-masked-view',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/MaskedView',\n        sourceAndroidPath: 'android/src/main/java/org/reactnative/maskedview',\n        targetAndroidPath: 'modules/api/components/maskedview',\n        sourceAndroidPackage: 'org.reactnative.maskedview',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.maskedview',\n      },\n    ],\n  },\n  '@react-native-community/viewpager': {\n    repoUrl: 'https://github.com/react-native-community/react-native-viewpager',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/ViewPager',\n        sourceAndroidPath: 'android/src/main/java/com/reactnativecommunity/viewpager',\n        targetAndroidPath: 'modules/api/components/viewpager',\n        sourceAndroidPackage: 'com.reactnativecommunity.viewpager',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.viewpager',\n      },\n    ],\n  },\n  'react-native-shared-element': {\n    repoUrl: 'https://github.com/IjzerenHein/react-native-shared-element',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/SharedElement',\n        sourceAndroidPath: 'android/src/main/java/com/ijzerenhein/sharedelement',\n        targetAndroidPath: 'modules/api/components/sharedelement',\n        sourceAndroidPackage: 'com.ijzerenhein.sharedelement',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.sharedelement',\n      },\n    ],\n  },\n  '@react-native-community/segmented-control': {\n    repoUrl: 'https://github.com/react-native-community/segmented-control',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/SegmentedControl',\n      },\n    ],\n  },\n  '@react-native-picker/picker': {\n    repoUrl: 'https://github.com/react-native-picker/picker',\n    installableInManagedApps: true,\n    steps: [\n      {\n        sourceIosPath: 'ios',\n        targetIosPath: 'Api/Components/Picker',\n        sourceAndroidPath: 'android/src/main/java/com/reactnativecommunity/picker',\n        targetAndroidPath: 'modules/api/components/picker',\n        sourceAndroidPackage: 'com.reactnativecommunity.picker',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.picker',\n      },\n    ],\n  },\n  '@react-native-community/slider': {\n    repoUrl: 'https://github.com/react-native-community/react-native-slider',\n    installableInManagedApps: true,\n    packageJsonPath: 'src',\n    steps: [\n      {\n        sourceIosPath: 'src/ios',\n        targetIosPath: 'Api/Components/Slider',\n        sourceAndroidPath: 'src/android/src/main/java/com/reactnativecommunity/slider',\n        targetAndroidPath: 'modules/api/components/slider',\n        sourceAndroidPackage: 'com.reactnativecommunity.slider',\n        targetAndroidPackage: 'versioned.host.exp.exponent.modules.api.components.slider',\n      },\n    ],\n  },\n};\n\nasync function getBundledNativeModulesAsync(): Promise<{ [key: string]: string }> {\n  return (await JsonFile.readAsync(BUNDLED_NATIVE_MODULES_PATH)) as { [key: string]: string };\n}\n\nasync function updateBundledNativeModulesAsync(updater) {\n  console.log(`\\nUpdating ${chalk.magenta('bundledNativeModules.json')} ...`);\n\n  const jsonFile = new JsonFile(BUNDLED_NATIVE_MODULES_PATH);\n  const data = await jsonFile.readAsync();\n  await jsonFile.writeAsync(await updater(data));\n}\n\nasync function renameIOSSymbolsAsync(file: string, iosPrefix: string) {\n  const content = await fs.readFile(file, 'utf8');\n\n  // Do something more sophisticated if this causes issues with more complex modules.\n  const transformedContent = content.replace(new RegExp(iosPrefix, 'g'), 'EX');\n  const newFileName = file.replace(iosPrefix, 'EX');\n\n  await fs.writeFile(newFileName, transformedContent, 'utf8');\n  await fs.remove(file);\n}\n\nasync function findObjcFilesAsync(dir: string, recursive: boolean): Promise<string[]> {\n  const pattern = path.join(dir, recursive ? '**' : '', '*.@(h|m|c|mm|cpp|swift)');\n  return await glob(pattern);\n}\n\nasync function renamePackageAndroidAsync(\n  file: string,\n  sourceAndroidPackage: string,\n  targetAndroidPackage: string\n) {\n  const content = await fs.readFile(file, 'utf8');\n\n  // Note: this only works for a single package. If react-native-svg separates\n  // its code into multiple packages we will have to do something more\n  // sophisticated here.\n  const transformedContent = content.replace(\n    new RegExp(sourceAndroidPackage, 'g'),\n    targetAndroidPackage\n  );\n\n  await fs.writeFile(file, transformedContent, 'utf8');\n}\n\nasync function findAndroidFilesAsync(dir: string): Promise<string[]> {\n  const pattern = path.join(dir, '**', '*.@(java|kt)');\n  return await glob(pattern);\n}\n\nasync function loadXcodeprojFileAsync(file: string): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const pbxproj = xcode.project(file);\n    pbxproj.parse((err) => (err ? reject(err) : resolve(pbxproj)));\n  });\n}\n\nfunction pbxGroupChild(file) {\n  const obj = Object.create(null);\n  obj.value = file.fileRef;\n  obj.comment = file.basename;\n  return obj;\n}\n\nfunction pbxGroupHasChildWithRef(group: any, ref: string): boolean {\n  return group.children.some((child) => child.value === ref);\n}\n\nasync function addFileToPbxprojAsync(\n  filePath: string,\n  targetDir: string,\n  pbxproj: any\n): Promise<void> {\n  const fileName = path.basename(filePath);\n\n  // The parent group of the target directory that should already be created in the project, e.g. `Components` or `Api`.\n  const targetGroup = pbxproj.pbxGroupByName(path.basename(path.dirname(targetDir)));\n\n  if (!pbxproj.hasFile(fileName)) {\n    console.log(`Adding ${chalk.magenta(fileName)} to pbxproj configuration ...`);\n\n    const fileOptions = {\n      // Mute warnings from 3rd party modules.\n      compilerFlags: '-w',\n    };\n\n    // The group name is mostly just a basename of the path.\n    const groupName = path.basename(path.dirname(filePath));\n\n    // Add a file to pbxproj tree.\n    const file =\n      path.extname(fileName) === '.h'\n        ? pbxproj.addHeaderFile(fileName, fileOptions, groupName)\n        : pbxproj.addSourceFile(fileName, fileOptions, groupName);\n\n    // Search for the group where the file should be placed.\n    const group = pbxproj.pbxGroupByName(groupName);\n\n    // Our files has `includeInIndex` set to 1, so let's continue doing that.\n    file.includeInIndex = 1;\n\n    if (group) {\n      // Add a file if it is not there already.\n      if (!pbxGroupHasChildWithRef(group, file.fileRef)) {\n        group.children.push(pbxGroupChild(file));\n      }\n    } else {\n      // Create a pbx group with this file.\n      const { uuid } = pbxproj.addPbxGroup([file.path], groupName, groupName);\n\n      // Add newly created group to the parent group.\n      if (!pbxGroupHasChildWithRef(targetGroup, uuid)) {\n        targetGroup.children.push(pbxGroupChild({ fileRef: uuid, basename: groupName }));\n      }\n    }\n  }\n}\n\nasync function copyFilesAsync(\n  files: string[],\n  sourceDir: string,\n  targetDir: string\n): Promise<void> {\n  for (const file of files) {\n    const fileRelativePath = path.relative(sourceDir, file);\n    const fileTargetPath = path.join(targetDir, fileRelativePath);\n\n    await fs.mkdirs(path.dirname(fileTargetPath));\n    await fs.copy(file, fileTargetPath);\n\n    console.log(chalk.yellow('>'), chalk.magenta(path.relative(EXPO_DIR, fileTargetPath)));\n  }\n}\n\nasync function listAvailableVendoredModulesAsync(onlyOutdated: boolean = false) {\n  const bundledNativeModules = await getBundledNativeModulesAsync();\n  const vendoredPackageNames = Object.keys(vendoredModulesConfig);\n  const packageViews: Npm.PackageViewType[] = await Promise.all(\n    vendoredPackageNames.map((packageName: string) => Npm.getPackageViewAsync(packageName))\n  );\n\n  for (const packageName of vendoredPackageNames) {\n    const packageView = packageViews.shift();\n\n    if (!packageView) {\n      console.error(\n        chalk.red.bold(`Couldn't get package view for ${chalk.green.bold(packageName)}.\\n`)\n      );\n      continue;\n    }\n\n    const moduleConfig = vendoredModulesConfig[packageName];\n    const bundledVersion = bundledNativeModules[packageName];\n    const latestVersion = packageView.versions[packageView.versions.length - 1];\n\n    if (!onlyOutdated || !bundledVersion || semver.gtr(latestVersion, bundledVersion)) {\n      console.log(chalk.bold.green(packageName));\n      console.log(`${chalk.yellow('>')} repository     : ${chalk.magenta(moduleConfig.repoUrl)}`);\n      console.log(\n        `${chalk.yellow('>')} bundled version: ${(bundledVersion ? chalk.cyan : chalk.gray)(\n          bundledVersion\n        )}`\n      );\n      console.log(`${chalk.yellow('>')} latest version : ${chalk.cyan(latestVersion)}`);\n      console.log();\n    }\n  }\n}\n\nasync function askForModuleAsync(): Promise<string> {\n  const { moduleName } = await inquirer.prompt<{ moduleName: string }>([\n    {\n      type: 'list',\n      name: 'moduleName',\n      message: 'Which 3rd party module would you like to update?',\n      choices: Object.keys(vendoredModulesConfig),\n    },\n  ]);\n  return moduleName;\n}\n\nasync function action(options: ActionOptions) {\n  if (options.list || options.listOutdated) {\n    await listAvailableVendoredModulesAsync(options.listOutdated);\n    return;\n  }\n\n  const moduleName = options.module || (await askForModuleAsync());\n  const moduleConfig = vendoredModulesConfig[moduleName];\n\n  if (!moduleConfig) {\n    throw new Error(\n      `Module \\`${chalk.green(\n        moduleName\n      )}\\` doesn't match any of currently supported 3rd party modules. Run with \\`--list\\` to show a list of modules.`\n    );\n  }\n\n  moduleConfig.installableInManagedApps =\n    moduleConfig.installableInManagedApps == null ? true : moduleConfig.installableInManagedApps;\n\n  const tmpDir = path.join(os.tmpdir(), moduleName);\n\n  // Cleanup tmp dir.\n  await fs.remove(tmpDir);\n\n  console.log(\n    `Cloning ${chalk.green(moduleName)}${chalk.red('#')}${chalk.cyan(\n      options.commit\n    )} from GitHub ...`\n  );\n\n  // Clone the repository.\n  await spawnAsync('git', ['clone', moduleConfig.repoUrl, tmpDir]);\n\n  // Checkout at given commit (defaults to master).\n  await spawnAsync('git', ['checkout', options.commit], { cwd: tmpDir });\n\n  if (moduleConfig.warnings) {\n    moduleConfig.warnings.forEach((warning) => console.warn(warning));\n  }\n\n  if (moduleConfig.moduleModifier) {\n    await moduleConfig.moduleModifier(moduleConfig, tmpDir);\n  }\n\n  for (const step of moduleConfig.steps) {\n    const executeAndroid = ['all', 'android'].includes(options.platform);\n    const executeIOS = ['all', 'ios'].includes(options.platform);\n\n    step.recursive = step.recursive === true;\n    step.updatePbxproj = !(step.updatePbxproj === false);\n\n    // iOS\n    if (executeIOS && step.sourceIosPath && step.targetIosPath) {\n      const sourceDir = path.join(tmpDir, step.sourceIosPath);\n      const targetDir = path.join(IOS_DIR, 'Exponent', 'Versioned', 'Core', step.targetIosPath);\n\n      console.log(\n        `\\nCleaning up iOS files at ${chalk.magenta(path.relative(IOS_DIR, targetDir))} ...`\n      );\n\n      await fs.remove(targetDir);\n      await fs.mkdirs(targetDir);\n\n      console.log('\\nCopying iOS files ...');\n\n      const objcFiles = await findObjcFilesAsync(sourceDir, step.recursive);\n      const pbxprojPath = path.join(IOS_DIR, 'Exponent.xcodeproj', 'project.pbxproj');\n      const pbxproj = await loadXcodeprojFileAsync(pbxprojPath);\n\n      await copyFilesAsync(objcFiles, sourceDir, targetDir);\n\n      if (options.pbxproj && step.updatePbxproj) {\n        console.log(`\\nUpdating pbxproj configuration ...`);\n\n        for (const file of objcFiles) {\n          const fileRelativePath = path.relative(sourceDir, file);\n          const fileTargetPath = path.join(targetDir, fileRelativePath);\n\n          await addFileToPbxprojAsync(fileTargetPath, targetDir, pbxproj);\n        }\n\n        console.log(\n          `Saving updated pbxproj structure to the file ${chalk.magenta(\n            path.relative(IOS_DIR, pbxprojPath)\n          )} ...`\n        );\n        await fs.writeFile(pbxprojPath, pbxproj.writeSync());\n      }\n\n      if (step.iosPrefix) {\n        console.log(`\\nUpdating classes prefix to ${chalk.yellow(step.iosPrefix)} ...`);\n\n        const files = await findObjcFilesAsync(targetDir, step.recursive);\n\n        for (const file of files) {\n          await renameIOSSymbolsAsync(file, step.iosPrefix);\n        }\n      }\n\n      console.log(\n        chalk.yellow(\n          `\\nSuccessfully updated iOS files, but please make sure Xcode project files are setup correctly in ${chalk.magenta(\n            `Exponent/Versioned/Core/${step.targetIosPath}`\n          )}`\n        )\n      );\n    }\n\n    // Android\n    if (\n      executeAndroid &&\n      step.sourceAndroidPath &&\n      step.targetAndroidPath &&\n      step.sourceAndroidPackage &&\n      step.targetAndroidPackage\n    ) {\n      const sourceDir = path.join(tmpDir, step.sourceAndroidPath);\n      const targetDir = path.join(\n        ANDROID_DIR,\n        'expoview',\n        'src',\n        'main',\n        'java',\n        'versioned',\n        'host',\n        'exp',\n        'exponent',\n        step.targetAndroidPath\n      );\n\n      console.log(\n        `\\nCleaning up Android files at ${chalk.magenta(path.relative(ANDROID_DIR, targetDir))} ...`\n      );\n\n      await fs.remove(targetDir);\n      await fs.mkdirs(targetDir);\n\n      console.log('\\nCopying Android files ...');\n\n      const javaFiles = await findAndroidFilesAsync(sourceDir);\n\n      await copyFilesAsync(javaFiles, sourceDir, targetDir);\n\n      const files = await findAndroidFilesAsync(targetDir);\n\n      for (const file of files) {\n        await renamePackageAndroidAsync(file, step.sourceAndroidPackage, step.targetAndroidPackage);\n      }\n    }\n  }\n  const { name, version } = await JsonFile.readAsync<{\n    name: string;\n    version: string;\n  }>(path.join(tmpDir, moduleConfig.packageJsonPath ?? '', 'package.json'));\n  const semverPrefix =\n    (options.semverPrefix != null ? options.semverPrefix : moduleConfig.semverPrefix) || '';\n  const versionRange = `${semverPrefix}${version}`;\n\n  await updateBundledNativeModulesAsync(async (bundledNativeModules) => {\n    if (moduleConfig.installableInManagedApps) {\n      bundledNativeModules[name] = versionRange;\n      console.log(\n        `Updated ${chalk.green(name)} in ${chalk.magenta(\n          'bundledNativeModules.json'\n        )} to version range ${chalk.cyan(versionRange)}`\n      );\n    } else if (bundledNativeModules[name]) {\n      delete bundledNativeModules[name];\n      console.log(\n        `Removed non-installable package ${chalk.green(name)} from ${chalk.magenta(\n          'bundledNativeModules.json'\n        )}`\n      );\n    }\n    return bundledNativeModules;\n  });\n\n  console.log(`\\nUpdating ${chalk.green(name)} in workspace projects...`);\n\n  await Workspace.updateDependencyAsync(name, versionRange);\n\n  console.log(`\\nRunning \\`${chalk.cyan(`yarn`)}\\`...`);\n\n  // We updated dependencies so we need to run yarn.\n  await Workspace.installAsync();\n\n  console.log(\n    `\\nFinished updating ${chalk.green(\n      moduleName\n    )}, make sure to update files in the Xcode project (if you updated iOS, see logs above) and test that it still works. `\n  );\n}\n\nexport default (program: Command) => {\n  program\n    .command('update-vendored-module')\n    .alias('update-module', 'uvm')\n    .description('Updates 3rd party modules.')\n    .option('-l, --list', 'Shows a list of available 3rd party modules.', false)\n    .option('-o, --list-outdated', 'Shows a list of outdated 3rd party modules.', false)\n    .option('-m, --module <string>', 'Name of the module to update.')\n    .option(\n      '-p, --platform <string>',\n      'A platform on which the vendored module will be updated.',\n      'all'\n    )\n    .option(\n      '-c, --commit <string>',\n      'Git reference on which to checkout when copying 3rd party module.',\n      'master'\n    )\n    .option(\n      '-s, --semver-prefix <string>',\n      'Setting this flag forces to use given semver prefix. Some modules may specify them by the config, but in case we want to update to alpha/beta versions we should use an empty prefix to be more strict.',\n      null\n    )\n    .option('--no-pbxproj', 'Whether to skip updating project.pbxproj file.', false)\n    .asyncAction(action);\n};\n"]}